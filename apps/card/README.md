# Card 模块

## 简介

`Card` 模块负责系统中卡密类型和卡密的创建、查询、更新和删除等功能。该模块允许用户创建不同类型的卡密，生成卡密，并管理卡密的状态。卡密是系统中用户授权和访问控制的重要组成部分。

## 功能特点

- 卡密类型管理：创建、查询、更新和删除卡密类型
- 卡密生成：批量生成卡密，支持自定义前缀
- 卡密管理：查询、更新和删除卡密
- 卡密状态控制：管理卡密的激活、过期和禁用状态
- 设备绑定控制：支持设置最大换绑次数和解绑次数

## 模块结构

```
card/
├── controller.go          # 控制器，处理HTTP请求
├── model/                 # 数据模型
│   ├── request.go         # 请求模型
│   └── response.go        # 响应模型
├── router.go              # 路由配置
├── service.go             # 业务逻辑服务
└── README.md              # 模块说明文档
```

## API 接口

### 获取卡密类型列表

- **URL**: `/api/card/types`
- **方法**: GET
- **认证**: 需要JWT令牌
- **描述**: 获取卡密类型列表
- **查询参数**:
  - `page`: 页码，默认为1
  - `page_size`: 每页记录数，默认为10
- **响应示例**:

```json
{
  "code": 200,
  "data": {
    "list": [...],  // 卡密类型列表
    "pagination": {
      "current_page": 1,
      "page_size": 10,
      "total": 5
    }
  },
  "message": "获取成功"
}
```

### 创建卡密类型

- **URL**: `/api/card/types`
- **方法**: POST
- **认证**: 需要JWT令牌
- **描述**: 创建新的卡密类型
- **请求示例**:

```json
{
  "name": "月卡",
  "description": "有效期30天的卡密",
  "duration": 30,
  "time_unit": "day",
  "price": 29.9,
  "app_id": 1,
  "default_max_rebind_count": 3,
  "default_max_unbind_count": 1
}
```

- **响应示例**:

```json
{
  "code": 200,
  "data": {
    "id": 1,
    "name": "月卡",
    "description": "有效期30天的卡密",
    "duration": 30,
    "time_unit": "day",
    "price": 29.9,
    "status": 1,
    "app_id": 1,
    "app_name": "测试应用",
    "default_max_rebind_count": 3,
    "default_max_unbind_count": 1,
    "created_at": "2023-01-01T12:00:00Z",
    "updated_at": "2023-01-01T12:00:00Z"
  },
  "message": "创建成功"
}
```

### 生成卡密

- **URL**: `/api/card/generate`
- **方法**: POST
- **认证**: 需要JWT令牌
- **描述**: 批量生成卡密
- **请求示例**:

```json
{
  "type_id": 1,
  "count": 10,
  "prefix": "TEST",
  "max_rebind_count": 3,
  "max_unbind_count": 1
}
```

- **响应示例**:

```json
{
  "code": 200,
  "data": {
    "success": true,
    "count": 10,
    "cards": [
      {
        "card_no": "TEST123456",
        "card_key": "ABCDEF123456"
      },
      // 更多卡密...
    ]
  },
  "message": "生成成功"
}
```

## 使用说明

1. 用户首先创建卡密类型，设置有效期、价格等参数
2. 然后批量生成卡密，可以设置前缀和数量
3. 卡密生成后，可以导出或分发给用户
4. 用户使用卡密激活应用，系统会自动绑定设备并设置过期时间
5. 卡密可以在限定次数内进行设备换绑和解绑操作

## 卡密状态说明

- **未使用 (0)**: 卡密已生成但尚未激活
- **已使用 (1)**: 卡密已被激活并绑定到设备
- **已过期 (2)**: 卡密已过期，不再有效
- **已禁用 (3)**: 卡密被手动禁用

## 时间单位说明

- **天 (day)**: 卡密有效期按天计算
- **月 (month)**: 卡密有效期按月计算
- **年 (year)**: 卡密有效期按年计算

## 开发与扩展

如需扩展卡密模块功能，可以考虑以下方向：

1. 添加卡密批量导入功能
2. 实现卡密激活码打印功能
3. 添加卡密使用统计和分析功能
4. 实现卡密续期和升级功能
5. 添加卡密分销和佣金系统