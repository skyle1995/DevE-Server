# Auth 模块

## 简介

`Auth` 模块负责系统的用户认证和授权功能，是系统安全的核心组件。该模块处理用户登录、注册、密码管理以及JWT令牌的生成和验证，确保只有授权用户才能访问受保护的资源。

## 功能特点

- 用户认证：处理用户登录请求，验证用户凭据
- 用户注册：处理新用户注册流程
- 密码管理：更新用户密码，密码哈希处理
- JWT令牌：生成和验证JWT令牌，用于无状态认证
- 用户信息：获取当前登录用户的信息

## 模块结构

```
auth/
├── controller.go          # 控制器，处理HTTP请求
├── model/                 # 数据模型
│   ├── jwt.go             # JWT令牌相关模型和方法
│   └── password.go        # 密码处理相关方法
├── service.go             # 业务逻辑服务
└── README.md              # 模块说明文档
```

## API 接口

### 用户登录

- **URL**: `/api/auth/login`
- **方法**: POST
- **认证**: 无需认证
- **描述**: 验证用户凭据并生成JWT令牌
- **请求示例**:

```json
{
  "username": "admin",
  "password": "password123"
}
```

- **响应示例**:

```json
{
  "code": 200,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  },
  "message": "登录成功"
}
```

### 用户注册

- **URL**: `/api/auth/register`
- **方法**: POST
- **认证**: 无需认证
- **描述**: 创建新用户账户
- **请求示例**:

```json
{
  "username": "newuser",
  "password": "password123",
  "email": "user@example.com"
}
```

- **响应示例**:

```json
{
  "code": 200,
  "data": null,
  "message": "注册成功"
}
```

### 获取用户信息

- **URL**: `/api/user/info`
- **方法**: GET
- **认证**: 需要JWT令牌
- **描述**: 获取当前登录用户的详细信息
- **响应示例**:

```json
{
  "code": 200,
  "data": {
    "id": 1,
    "username": "admin",
    "email": "admin@example.com",
    "role": 1,
    "status": 1,
    "created_at": "2023-01-01T12:00:00Z",
    "last_login": "2023-01-02T12:00:00Z"
  },
  "message": "获取成功"
}
```

## 使用说明

1. 用户通过登录接口提交用户名和密码
2. 系统验证用户凭据，成功后生成JWT令牌并返回
3. 客户端存储JWT令牌，并在后续请求中通过Authorization头部发送
4. 系统通过中间件验证JWT令牌，并将用户信息存储到上下文中
5. 业务接口可以从上下文中获取用户信息，进行权限控制

## 认证流程

1. **登录流程**：
   - 用户提交用户名和密码
   - 系统验证用户凭据
   - 如果验证成功，生成JWT令牌并返回
   - 更新用户最后登录时间

2. **JWT验证流程**：
   - 从请求头获取令牌
   - 解析和验证令牌
   - 检查令牌是否过期
   - 查询用户是否存在且状态正常
   - 将用户信息存储到上下文中

## 开发与扩展

如需扩展认证模块功能，可以考虑以下方向：

1. 添加第三方登录支持（如OAuth2.0）
2. 实现多因素认证
3. 添加登录尝试限制和IP封禁功能
4. 实现令牌刷新机制
5. 添加用户角色和权限管理